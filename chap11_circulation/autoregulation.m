%  -------------------------------------------------------------------%%   Autoregulation in the three-compartment circulation model%%   For Chapter 11, Section 11.6.2 of%   Keener and Sneyd, Mathematical Physiology, 3rd Edition, Springer.% %   Written by James Keener and James Sneyd.% %  ------------------------------------------------------------------- clear allclose allclcsyms Pa Pv Va Vv Q Oa Ovsyms Cd F Ca Cv Vt Rssyms Smax beta Pastar M A KPS = KP*Smax/(KP + Pa);Rs = S + A*Ov;fun1 = Q - F*Cd*Pv;fun2 = Q - (Pa-Pv)/Rs;fun3 = Va - Ca*Pa;fun4 = Vv - Cv*Pv;% volumefun5 = Vt - Va - Vv;% regulationafun1 = M - Q*(Oa-Ov);eqns = [fun1==0,fun2==0,fun3==0,fun4==0,fun5==0,afun1==0];vars = [F,Pv,Va,Vv,Q,Ov];   % Assuming that Pa and Oa are known, fixed, parameters.sols = solve(eqns,vars);pretty(simplify(sols.Q,150))pretty(simplify(sols.F,150))% Now do the substitutions to write solution in different waypretty(simplify(subs(sols.Q,Vt,Pa*Ca+Pv*Cv),150))pretty(simplify(subs(sols.F,Vt,Pa*Ca+Pv*Cv),150))% Now calculate the derivatives. Substitute for Vt AFTER differentiating.%pretty(simplify(subs(diff(sols.Q,Pa),Vt,Pa*Ca+Pv*Cv),150))%pretty(simplify(subs(diff(sols.F,Pa),Vt,Pa*Ca+Pv*Cv),150))% Finally, the calculations for the largest possible metabolic rateM = solve(sols.Ov==0,M);pretty(simplify(subs(M,Vt,Pa*Ca+Pv*Cv)))